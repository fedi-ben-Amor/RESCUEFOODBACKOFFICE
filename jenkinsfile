pipeline {
    agent any
    stages {
        stage('Docker Login') {
            steps {
                script {
                    // Login to Docker Hub
                    withCredentials([usernamePassword(credentialsId: 'DockerHubCredentials', usernameVariable: 'fedibenamor', passwordVariable: '{AQAAABAAAAAQvyR65WmQGsjYJZxERHbenHna+bVH6ZmDfe4sqqrJJ+Q=}')]) {
                        sh 'echo $DOCKER_PASSWORD | docker login -u $DOCKER_USERNAME --password-stdin'
                    }
                }
            }
        }
        stage('Pull Docker Image') {
            steps {
                script {
                    // Pull the Docker image from Docker Hub
                    sh 'docker pull fedibenamor/rescuefood:latest'
                }
            }
        }
        stage('Run Application') {
            steps {
                script {
                    // Run the application image as a container
                    sh 'docker run -d --name rescuefood-container fedibenamor/rescuefood:latest'
                }
            }
        }
        stage('Clean Up') {
            steps {
                script {
                    // Stop and remove the container if needed
                    sh 'docker stop rescuefood-container || true'
                    sh 'docker rm rescuefood-container || true'
                }
            }
        }
        stage('SMTP Notification Logs') {
            steps {
                emailext attachLog: true, 
                         body: 'Check our logs after running the pipeline', 
                         compressLog: true, 
                         subject: 'Jenkins Output Logs from Benamor Fedi Pipeline', 
                         to: 'benamorr.fedi@gmail.com'
            }
        }
    }
}
